<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rede Social</title>
    <style>
        /* Seus estilos antigos, melhorados com alguns detalhes mais modernos */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 500px;
            background: #1e1e1e;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 15px rgba(255, 255, 255, 0.1);
        }

        .input-box, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: none;
            font-size: 16px;
            background: #333;
            color: #e0e0e0;
        }

        .button {
            background: #00ffcc;
            color: #121212;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .post, .reply {
            background: #222;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .reply {
            margin-left: 20px;
            border-left: 2px solid #00ffcc;
            padding-left: 10px;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }

        .like-btn, .reply-btn {
            border: none;
            background: none;
            cursor: pointer;
            color: #00ffcc;
            font-size: 14px;
        }

        .liked {
            color: #ff4d4d;
        }

        .upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #00ffcc;
            color: #121212;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            width: 100%;
            margin-top: 10px;
        }

        .upload-input { display: none; }

        .image-preview {
            max-width: 100%;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container" id="loginBox">
        <h2>Entrar</h2>
        <input type="text" id="username" class="input-box" placeholder="Digite seu nome">
        <button class="button" onclick="requestPassword()">Entrar</button>
    </div>

    <div class="container hidden" id="mainApp">
        <h2>Feed</h2>
        <textarea id="postContent" placeholder="O que vocÃª estÃ¡ pensando?"></textarea>

        <label for="postMedia" class="upload-label">ðŸ“· Adicionar Imagem</label>
        <input type="file" id="postMedia" class="upload-input" accept="image/*">
        <img id="imagePreview" class="image-preview">

        <button class="button" onclick="postar()">Postar</button>

        <div id="feed"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBM_NCmVeM93l8vv9iGbUnFIyIBU0_a2zs",
            authDomain: "escolarelatosx-b25e2.firebaseapp.com",
            databaseURL: "https://escolarelatosx-b25e2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "escolarelatosx-b25e2",
            storageBucket: "escolarelatosx-b25e2.appspot.com",
            messagingSenderId: "474818683762",
            appId: "1:474818683762:web:137cc278602db0218073eb",
            measurementId: "G-MFDKLX3TV6"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const storage = firebase.storage();

        function requestPassword() {
            let password = prompt("Digite a senha:");
            if (password === "Escola25") {
                let username = document.getElementById("username").value;
                localStorage.setItem("username", username);
                document.getElementById("loginBox").classList.add("hidden");
                document.getElementById("mainApp").classList.remove("hidden");
            } else {
                alert("Senha incorreta!");
            }
        }

        document.getElementById("postMedia").addEventListener("change", function(event) {
            let file = event.target.files[0];
            if (file) {
                let url = URL.createObjectURL(file);
                let preview = document.getElementById("imagePreview");
                preview.src = url;
                preview.style.display = "block";
            }
        });

        function postar() {
            let content = document.getElementById("postContent").value;
            let file = document.getElementById("postMedia").files[0];
            let username = localStorage.getItem("username");

            if (!content && !file) {
                alert("Escreva algo ou selecione uma imagem!");
                return;
            }

            // Save post to Firebase Realtime Database
            let postRef = db.ref("posts").push();
            let postId = postRef.key;

            if (file) {
                let storageRef = storage.ref(`posts/${postId}/${file.name}`);
                storageRef.put(file).then(snapshot => {
                    snapshot.ref.getDownloadURL().then(url => {
                        salvarPost(postId, username, content, url);
                    });
                }).catch((error) => {
                    console.error("Erro ao enviar o arquivo:", error);
                });
            } else {
                salvarPost(postId, username, content, "");
            }
        }

        function salvarPost(postId, username, content, mediaUrl) {
            db.ref("posts/" + postId).set({
                username: username,
                content: content,
                mediaUrl: mediaUrl,
                timestamp: Date.now()
            }).then(() => {
                carregarPosts();  // Atualiza o feed apÃ³s postar
                document.getElementById("postContent").value = "";
                document.getElementById("postMedia").value = "";
                document.getElementById("imagePreview").style.display = "none";
            }).catch((error) => {
                console.error("Erro ao salvar o post:", error);
            });
        }

        function carregarPosts() {
            db.ref("posts").orderByChild("timestamp").on("value", function(snapshot) {
                let feed = document.getElementById("feed");
                feed.innerHTML = "";
                snapshot.forEach(function(childSnapshot) {
                    let postData = childSnapshot.val();
                    let postElement = criarPost(postData.content, postData.username, postData.mediaUrl, childSnapshot.key);
                    feed.appendChild(postElement);
                });
            });
        }

        function criarPost(content, username, mediaUrl, postId) {
            let postElement = document.createElement("div");
            postElement.classList.add("post");

            let postText = document.createElement("p");
            postText.innerHTML = `<strong>${username}:</strong> ${content}`;

            if (mediaUrl) {
                let img = document.createElement("img");
                img.src = mediaUrl;
                img.classList.add("image-preview");
                postElement.appendChild(img);
            }

            let actions = document.createElement("div");
            actions.classList.add("actions");

            let likeBtn = document.createElement("button");
            likeBtn.innerHTML = "â™¥ï¸Ž Curtir <span class='like-count'>0</span>";
            likeBtn.classList.add("like-btn");
            likeBtn.onclick = function () {
                let