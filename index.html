<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rede Social</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 500px;
            background: #1e1e1e;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 15px rgba(255, 255, 255, 0.1);
        }

        .hidden { display: none; }

        .input-box, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: none;
            font-size: 16px;
            background: #333;
            color: #e0e0e0;
        }

        .button {
            background: #00ffcc;
            color: #121212;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .post, .reply {
            background: #222;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .reply {
            margin-left: 20px;
            border-left: 2px solid #00ffcc;
            padding-left: 10px;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }

        .like-btn, .reply-btn {
            border: none;
            background: none;
            cursor: pointer;
            color: #00ffcc;
            font-size: 14px;
        }

        .liked {
            color: #ff4d4d;
        }

        .upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #00ffcc;
            color: #121212;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            width: 100%;
            margin-top: 10px;
        }

        .upload-input { display: none; }

        .image-preview {
            max-width: 100%;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
        }

        #notifications {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #00ffcc;
            color: #121212;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login -->
    <div class="container" id="loginBox">
        <h2>Entrar</h2>
        <input type="text" id="username" class="input-box" placeholder="Digite seu nome">
        <input type="file" id="profileImage" class="upload-input" accept="image/*">
        <button class="button" onclick="requestPassword()">Entrar</button>
    </div>

    <!-- Feed Principal -->
    <div class="container hidden" id="mainApp">
        <h2>Feed</h2>
        <textarea id="postContent" placeholder="O que voc√™ est√° pensando?"></textarea>

        <label for="postMedia" class="upload-label">üì∑ Adicionar Imagem</label>
        <input type="file" id="postMedia" class="upload-input" accept="image/*">
        <img id="imagePreview" class="image-preview">

        <button class="button" onclick="postar()">Postar</button>

        <div id="feed"></div>
    </div>

    <!-- Notifica√ß√µes -->
    <div id="notifications" class="hidden">
        <h3>Notifica√ß√µes</h3>
        <ul id="notificationList"></ul>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js"></script>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBM_NCmVeM93l8vv9iGbUnFIyIBU0_a2zs",
            authDomain: "escolarelatosx-b25e2.firebaseapp.com",
            databaseURL: "https://escolarelatosx-b25e2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "escolarelatosx-b25e2",
            storageBucket: "escolarelatosx-b25e2.firebasestorage.app",
            messagingSenderId: "474818683762",
            appId: "1:474818683762:web:137cc278602db0218073eb",
            measurementId: "G-MFDKLX3TV6"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database(app);

        // Fun√ß√£o para solicitar a senha e autenticar o usu√°rio
        function requestPassword() {
            let username = document.getElementById("username").value;
            if (username) {
                localStorage.setItem("username", username);
                document.getElementById("loginBox").classList.add("hidden");
                document.getElementById("mainApp").classList.remove("hidden");

                carregarPosts();
            }
        }

        // Fun√ß√£o para postar conte√∫do
        function postar() {
            let content = document.getElementById("postContent").value;
            let file = document.getElementById("postMedia").files[0];
            let username = localStorage.getItem("username");

            if (!content && !file) {
                alert("Escreva algo ou selecione uma imagem!");
                return;
            }

            // Objeto do post a ser salvo
            let postData = {
                username: username,
                content: content,
                date: new Date().toISOString(),
                likes: 0,
                replies: []
            };

            // Se houver arquivo, armazene tamb√©m
            if (file) {
                let reader = new FileReader();
                reader.onloadend = function () {
                    postData.image = reader.result;
                    salvarPostNoFirebase(postData);
                };
                reader.readAsDataURL(file);
            } else {
                salvarPostNoFirebase(postData);
            }
        }

        // Fun√ß√£o para salvar o post no Firebase
        function salvarPostNoFirebase(postData) {
            let postRef = database.ref("posts").push();
            postRef.set(postData, function(error) {
                if (error) {
                    console.log("Erro ao salvar post:", error);
                } else {
                    console.log("Post salvo com sucesso!");
                    carregarPosts(); // Recarrega os posts ap√≥s salvar
                }
            });
        }

        // Fun√ß√£o para carregar posts do Firebase
        function carregarPosts() {
            const postsRef = database.ref("posts");

            postsRef.on("child_added", function(snapshot) {
                let postData = snapshot.val();
                let postElement = criarPost(postData.content, postData.username, postData.image);
                document.getElementById("feed").prepend(postElement);
            });
        }

        // Fun√ß√£o para criar a estrutura do post no HTML
        function criarPost(content, username, file) {
            let postElement = document.createElement("div");
            postElement.classList.add("post");

            let postText = document.createElement("p");
            postText.innerHTML = `<strong>${username}:</strong> ${content}`;

            if (file) {
                let img = document.createElement("img");
                img.src = file;
                img.classList.add("image-preview");
                img.style.display = "block";
                postElement.appendChild(img);
            }

            let actions = document.createElement("div");
            actions.classList.add("actions");

            let likeBtn = document.createElement("button");
            likeBtn.innerHTML = "‚ô•Ô∏é Curtir <span class='like-count'>0</span>";
            likeBtn.classList.add("like-btn");
            likeBtn.onclick = function () {
                let countSpan = likeBtn.querySelector(".like-count");
                let count = parseInt(countSpan.innerText);
                if (likeBtn.classList.contains("liked")) {
                    count--;
                } else {
                    count++;
                }
                countSpan.innerText = count;
                likeBtn.classList.toggle("liked");
            };

            let replyBtn = document.createElement("button");
            replyBtn.innerHTML = "üí¨ Responder";
            replyBtn.classList.add("reply-btn");
            replyBtn.onclick = function () { responder(postElement, username); };

            actions.appendChild(likeBtn);
            actions.appendChild(replyBtn);

            postElement.appendChild(postText);
            postElement.appendChild(actions);

            let replyContainer = document.createElement("div");
            replyContainer.classList.add("replies");
            postElement.appendChild(replyContainer);

            return postElement;
        }

        // Fun√ß√£o para adicionar resposta ao post
        function responder(postElement, username) {
            let replyContent = prompt("Digite sua resposta:");

            if (replyContent) {
                let replyElement = document.createElement("div");
                replyElement.classList.add("reply");
                replyElement.innerHTML = `<strong>${username}:</strong> ${replyContent}`;

                postElement.querySelector(".replies").appendChild(replyElement);

                // Salva a resposta no Firebase
                let postId = postElement.id;
                let repliesRef = database.ref("posts/" + postId + "/replies");
                repliesRef.push({
                    username: username,
                    content: replyContent
                });
            }
        }
    </script>
</body>
</html>
